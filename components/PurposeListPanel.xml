<?xml version = "1.0" encoding = "utf-8" ?>

<!--********** Copyright 2016 Roku Corp.  All Rights Reserved. **********-->

<component name = "PurposeListPanel" extends = "ListPanel" >

  <interface >
    <field id = "savebuttontext" type = "string" onChange = "updateSaveButtonText" /> 
    <field id = "categoriesToConsent" type = "assocarray" /> 
    <field id = "appendVendorPanel" type = "int" />
  </interface>

  <script type = "text/brightscript" >

    <![CDATA[

    sub init()
      m.top.panelSize = "medium"
      m.top.focusable = true
      m.top.hasNextPanel = true
      m.top.leftOnly = true
      m.top.createNextPanelOnItemFocus = false
      m.top.selectButtonMovesPanelForward = false

      m.top.list = m.top.findNode("purposeLabelList")
      m.infoLabel = m.top.findNode("saveLabel")
    end sub

    sub updateSaveButtonText()
      m.infoLabel.text = "Press * to " + m.top.savebuttontext
    end sub

    function onKeyEvent(key as String,press as Boolean) as Boolean
      if press then 
        if key = "options"
          categoriesString = ""
          n = m.top.list.content.getChildCount()
          categoriesArray = createObject("roArray", 0, true)
          for i = 0 to m.top.list.content.getChildCount() - 1
            checkedState = m.top.list.checkedState.getEntry(i)
            if checkedState
              categoriesArray.push(m.top.list.content.getChild(i).id)
              categoriesString = categoriesString + Chr(34) + m.top.list.content.getChild(i).id + Chr(34) + ","
            end if
          end for
          categoriesStringLength = Len(categoriesString)
          categoriesString = Left(categoriesString, categoriesStringLength - 1)
          categoriesString = "[" + categoriesString + "]"
          categoriesString = Chr(34) + "categories" + Chr(34) + ":" + categoriesString
          categoriesToConsent = CreateObject("roAssociativeArray")
          categoriesToConsent.AddReplace("categoriesString", categoriesString)
          categoriesToConsent.AddReplace("categoriesArray", categoriesArray)
          m.top.categoriesToConsent = categoriesToConsent
        end if
        if key = "replay"
          m.top.appendVendorPanel = RND(10000)
        end if
      end if
      return false
    end function

    ]]>

  </script>

  <children >
    <Group>
      <LayoutGroup
        itemSpacings = "[20, 40]">
        <Label 
          id = "purposeLabel"
          text = "Purposes"/>
        <CheckList 
          id = "purposeLabelList"/>
        <Label 
          id = "vendorsLabel"
          text = "Press Replay to access Vendors"
          font = "font:MediumBoldSystemFont" />
        <Label 
          id = "saveLabel" />
      </LayoutGroup>
    </Group>
  </children>

</component>
